import inherits from"inherits-browser";import CommandInterceptor from"diagram-js/lib/command/CommandInterceptor";import{getBusinessObject,is}from"../../util/ModelUtil";import{classes,domify}from"min-dom";import{getPlaneIdFromShape}from"../../util/DrilldownUtil";var LOW_PRIORITY=250,ARROW_DOWN_SVG='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.81801948,3.50735931 L10.4996894,9.1896894 L10.5,4 L12,4 L12,12 L4,12 L4,10.5 L9.6896894,10.4996894 L3.75735931,4.56801948 C3.46446609,4.27512627 3.46446609,3.80025253 3.75735931,3.50735931 C4.05025253,3.21446609 4.52512627,3.21446609 4.81801948,3.50735931 Z"/></svg>',EMPTY_MARKER="bjs-drilldown-empty";export default function DrilldownOverlayBehavior(e,t,r,l,a){CommandInterceptor.call(this,t),this._canvas=e,this._eventBus=t,this._elementRegistry=r,this._overlays=l,this._translate=a;var i=this;this.executed("shape.toggleCollapse",LOW_PRIORITY,(function(e){var t=e.shape;i._canDrillDown(t)?i._addOverlay(t):i._removeOverlay(t)}),!0),this.reverted("shape.toggleCollapse",LOW_PRIORITY,(function(e){var t=e.shape;i._canDrillDown(t)?i._addOverlay(t):i._removeOverlay(t)}),!0),this.executed(["shape.create","shape.move","shape.delete"],LOW_PRIORITY,(function(e){var t=e.oldParent,r=e.newParent||e.parent,l=e.shape;i._canDrillDown(l)&&i._addOverlay(l),i._updateDrilldownOverlay(t),i._updateDrilldownOverlay(r),i._updateDrilldownOverlay(l)}),!0),this.reverted(["shape.create","shape.move","shape.delete"],LOW_PRIORITY,(function(e){var t=e.oldParent,r=e.newParent||e.parent,l=e.shape;i._canDrillDown(l)&&i._addOverlay(l),i._updateDrilldownOverlay(t),i._updateDrilldownOverlay(r),i._updateDrilldownOverlay(l)}),!0),t.on("import.render.complete",(function(){r.filter((function(e){return i._canDrillDown(e)})).map((function(e){i._addOverlay(e)}))}))}inherits(DrilldownOverlayBehavior,CommandInterceptor),DrilldownOverlayBehavior.prototype._updateDrilldownOverlay=function(e){var t=this._canvas;if(e){var r=t.findRoot(e);r&&this._updateOverlayVisibility(r)}},DrilldownOverlayBehavior.prototype._canDrillDown=function(e){var t=this._canvas;return is(e,"bpmn:SubProcess")&&t.findRoot(getPlaneIdFromShape(e))},DrilldownOverlayBehavior.prototype._updateOverlayVisibility=function(e){var t=this._overlays,r=getBusinessObject(e),l=t.get({element:r.id,type:"drilldown"})[0];if(l){var a=r&&r.get("flowElements")&&r.get("flowElements").length;classes(l.html).toggle(EMPTY_MARKER,!a)}},DrilldownOverlayBehavior.prototype._addOverlay=function(e){var t=this._canvas,r=this._overlays,l=getBusinessObject(e);r.get({element:e,type:"drilldown"}).length&&this._removeOverlay(e);var a=domify('<button type="button" class="bjs-drilldown">'+ARROW_DOWN_SVG+"</button>"),i=l.get("name")||l.get("id"),o=this._translate("Open {element}",{element:i});a.setAttribute("title",o),a.addEventListener("click",(function(){t.setRootElement(t.findRoot(getPlaneIdFromShape(e)))})),r.add(e,"drilldown",{position:{bottom:-7,right:-8},html:a}),this._updateOverlayVisibility(e)},DrilldownOverlayBehavior.prototype._removeOverlay=function(e){this._overlays.remove({element:e,type:"drilldown"})},DrilldownOverlayBehavior.$inject=["canvas","eventBus","elementRegistry","overlays","translate"];