import inherits from"inherits-browser";import CommandInterceptor from"diagram-js/lib/command/CommandInterceptor";import{pointsAligned}from"diagram-js/lib/util/Geometry";import{assign}from"min-dash";var HIGH_PRIORITY=3e3;export default function GridSnappingLayoutConnectionBehavior(n,i,t){CommandInterceptor.call(this,n),this._gridSnapping=i;var e=this;this.postExecuted(["connection.create","connection.layout"],HIGH_PRIORITY,(function(n){var i=n.context,o=i.connection,r=i.hints||{},a=o.waypoints;r.connectionStart||r.connectionEnd||!1===r.createElementsBehavior||hasMiddleSegments(a)&&t.updateWaypoints(o,e.snapMiddleSegments(a))}))}function hasMiddleSegments(n){return n.length>3}function horizontallyAligned(n){return"h"===n}function verticallyAligned(n){return"v"===n}function snapSegment(n,i,t){var e=pointsAligned(i,t),o={};return horizontallyAligned(e)&&(o.y=n.snapValue(i.y)),verticallyAligned(e)&&(o.x=n.snapValue(i.x)),("x"in o||"y"in o)&&(i=assign({},i,o),t=assign({},t,o)),[i,t]}GridSnappingLayoutConnectionBehavior.$inject=["eventBus","gridSnapping","modeling"],inherits(GridSnappingLayoutConnectionBehavior,CommandInterceptor),GridSnappingLayoutConnectionBehavior.prototype.snapMiddleSegments=function(n){var i,t=this._gridSnapping;n=n.slice();for(var e=1;e<n.length-2;e++)i=snapSegment(t,n[e],n[e+1]),n[e]=i[0],n[e+1]=i[1];return n};