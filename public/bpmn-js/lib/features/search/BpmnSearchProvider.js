import{omit}from"min-dash";import{getLabel,isLabel}from"../../util/LabelUtil";export default function BpmnSearchProvider(e,n,t){this._elementRegistry=e,this._canvas=t,n.registerProvider(this)}function isMatch(e){return"matched"in e}function hasMatch(e){return e.find(isMatch)}function compareTokens(e,n){const t=hasMatch(e),r=hasMatch(n);if(t&&!r)return-1;if(!t&&r)return 1;if(!t&&!r)return 0;const i=e.find(isMatch),a=n.find(isMatch);return i.index<a.index?-1:i.index>a.index?1:0}function compareStrings(e="",n=""){return e.localeCompare(n)}function findMatches(e,n){var t=[],r=e;if(!e)return t;e=e.toLowerCase(),n=n.toLowerCase();var i=e.indexOf(n);return i>-1?(0!==i&&t.push({normal:r.slice(0,i),index:0}),t.push({matched:r.slice(i,i+n.length),index:i}),n.length+i<e.length&&t.push({normal:r.slice(i+n.length),index:i+n.length})):t.push({normal:r,index:0}),t}BpmnSearchProvider.$inject=["elementRegistry","searchPad","canvas"],BpmnSearchProvider.prototype.find=function(e){var n=this._canvas.getRootElements();return this._elementRegistry.filter((function(e){return!isLabel(e)&&!n.includes(e)})).reduce((function(n,t){var r=findMatches(getLabel(t),e),i=findMatches(t.id,e);return hasMatch(r)||hasMatch(i)?[...n,{primaryTokens:r,secondaryTokens:i,element:t}]:n}),[]).sort((function(e,n){return compareTokens(e.primaryTokens,n.primaryTokens)||compareTokens(e.secondaryTokens,n.secondaryTokens)||compareStrings(getLabel(e.element),getLabel(n.element))||compareStrings(e.element.id,n.element.id)})).map((function(e){return{element:e.element,primaryTokens:e.primaryTokens.map((function(e){return omit(e,["index"])})),secondaryTokens:e.secondaryTokens.map((function(e){return omit(e,["index"])}))}}))};