import{assign,forEach,isString,pick}from"min-dash";import{getDi,isAny}from"../../../util/ModelUtil";import{isLabel}from"../../../util/LabelUtil";import{isConnection}from"diagram-js/lib/util/ModelUtil";var DEFAULT_COLORS={fill:void 0,stroke:void 0};export default function SetColorHandler(e){this._commandStack=e,this._normalizeColor=function(e){if(e){if(isString(e)){var o=colorToHex(e);if(o)return o}throw new Error(`invalid color value: ${e}`)}}}function colorToHex(e){var o=document.createElement("canvas").getContext("2d");return o.fillStyle="transparent",o.fillStyle=e,/^#[0-9a-fA-F]{6}$/.test(o.fillStyle)?o.fillStyle:null}function ensureLegacySupport(e){"border-color"in e&&(e.stroke=e["border-color"]),"background-color"in e&&(e.fill=e["background-color"])}SetColorHandler.$inject=["commandStack"],SetColorHandler.prototype.postExecute=function(e){var o=e.elements,r=e.colors||DEFAULT_COLORS,t=this,i={};"fill"in r&&assign(i,{"background-color":this._normalizeColor(r.fill)}),"stroke"in r&&assign(i,{"border-color":this._normalizeColor(r.stroke)}),forEach(o,(function(e){var o=isConnection(e)?pick(i,["border-color"]):i,r=getDi(e);if(ensureLegacySupport(o),isLabel(e))t._commandStack.execute("element.updateModdleProperties",{element:e,moddleElement:r.label,properties:{color:i["border-color"]}});else{if(!isAny(r,["bpmndi:BPMNEdge","bpmndi:BPMNShape"]))return;t._commandStack.execute("element.updateProperties",{element:e,properties:{di:o}})}}))};