import{reduce,keys,forEach}from"min-dash";import{is,getBusinessObject}from"../../../util/ModelUtil";export default function UpdateModdlePropertiesHandler(e){this._elementRegistry=e}function getModdleProperties(e,t){return reduce(t,(function(t,r){return t[r]=e.get(r),t}),{})}function setModdleProperties(e,t){forEach(t,(function(t,r){e.set(r,t)}))}function getAllDataObjectReferences(e,t){return t.filter((function(t){return is(t,"bpmn:DataObjectReference")&&getBusinessObject(t).dataObjectRef===e}))}UpdateModdlePropertiesHandler.$inject=["elementRegistry"],UpdateModdlePropertiesHandler.prototype.execute=function(e){var t=e.element,r=e.moddleElement,o=e.properties;if(!r)throw new Error("<moddleElement> required");var n=e.changed||this._getVisualReferences(r).concat(t),d=e.oldProperties||getModdleProperties(r,keys(o));return setModdleProperties(r,o),e.oldProperties=d,e.changed=n,n},UpdateModdlePropertiesHandler.prototype.revert=function(e){var t=e.oldProperties,r=e.moddleElement,o=e.changed;return setModdleProperties(r,t),o},UpdateModdlePropertiesHandler.prototype._getVisualReferences=function(e){var t=this._elementRegistry;return is(e,"bpmn:DataObject")?getAllDataObjectReferences(e,t):[]};