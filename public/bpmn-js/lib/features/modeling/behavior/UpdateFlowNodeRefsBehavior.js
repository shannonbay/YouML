import inherits from"inherits-browser";import CommandInterceptor from"diagram-js/lib/command/CommandInterceptor";import{is}from"../../../util/ModelUtil";var LOW_PRIORITY=500,HIGH_PRIORITY=5e3;export default function UpdateFlowNodeRefsBehavior(e,t){var o;CommandInterceptor.call(this,e);var n=["spaceTool","lane.add","lane.resize","lane.split","elements.create","elements.delete","elements.move","shape.create","shape.delete","shape.move","shape.resize"];this.preExecute(n,HIGH_PRIORITY,(function(e){(o=o||new UpdateContext).enter()})),this.postExecuted(n,LOW_PRIORITY,(function(e){!function(){if(!o)throw new Error("out of bounds release");o.leave()&&(t.updateLaneRefs(o.flowNodes,o.lanes),o=null)}()})),this.preExecute(["shape.create","shape.move","shape.delete","shape.resize"],(function(e){var t=e.context.shape,n=function(){if(!o)throw new Error("out of bounds release");return o}();t.labelTarget||(is(t,"bpmn:Lane")&&n.addLane(t),is(t,"bpmn:FlowNode")&&n.addFlowNode(t))}))}function UpdateContext(){this.flowNodes=[],this.lanes=[],this.counter=0,this.addLane=function(e){this.lanes.push(e)},this.addFlowNode=function(e){this.flowNodes.push(e)},this.enter=function(){this.counter++},this.leave=function(){return this.counter--,!this.counter}}UpdateFlowNodeRefsBehavior.$inject=["eventBus","modeling"],inherits(UpdateFlowNodeRefsBehavior,CommandInterceptor);