import inherits from"inherits-browser";import CommandInterceptor from"diagram-js/lib/command/CommandInterceptor";import{getBusinessObject,is}from"../../../util/ModelUtil";import{isLabel}from"../../../util/LabelUtil";import{getBBox}from"diagram-js/lib/util/Elements";import{assign,find}from"min-dash";import{asTRBL}from"diagram-js/lib/layout/LayoutUtil";import{isConnection}from"diagram-js/lib/util/ModelUtil";var HORIZONTAL_PARTICIPANT_PADDING=20,VERTICAL_PARTICIPANT_PADDING=20;export var PARTICIPANT_BORDER_WIDTH=30;var HIGH_PRIORITY=2e3;export default function CreateParticipantBehavior(t,e,i){function n(){var e=t.getRootElement();return is(e,"bpmn:Collaboration")?e:i.makeCollaboration()}CommandInterceptor.call(this,e),e.on(["create.start","shape.move.start"],HIGH_PRIORITY,(function(e){var i=e.context,n=i.shape,r=t.getRootElement();if(is(n,"bpmn:Participant")&&is(r,"bpmn:Process")&&r.children.length){var s=r.children.filter((function(t){return!is(t,"bpmn:Group")&&!isLabel(t)&&!isConnection(t)}));if(s.length){var a=getBBox(s),o=getParticipantBounds(n,a);assign(n,o),i.createConstraints=getParticipantCreateConstraints(n,a)}}})),e.on("create.start",HIGH_PRIORITY,(function(i){var n=i.context.shape,r=t.getRootElement(),s=t.getGraphics(r);function a(t){t.element=r,t.gfx=s}is(n,"bpmn:Participant")&&is(r,"bpmn:Process")&&(e.on("element.hover",HIGH_PRIORITY,a),e.once("create.cleanup",(function(){e.off("element.hover",a)})))})),this.preExecute("elements.create",HIGH_PRIORITY,(function(t){var e,i=t.elements,r=t.parent,s=findParticipant(i);s&&is(r,"bpmn:Process")&&(t.parent=n(),(e=t.hints=t.hints||{}).participant=s,e.process=r,e.processRef=getBusinessObject(s).get("processRef"))}),!0),this.preExecute("shape.create",(function(t){var e=t.parent,i=t.shape;is(i,"bpmn:Participant")&&is(e,"bpmn:Process")&&(t.parent=n(),t.process=e,t.processRef=getBusinessObject(i).get("processRef"))}),!0),this.execute("shape.create",(function(t){var e=t.hints||{},i=t.process||e.process,n=t.shape,r=e.participant;!i||r&&n!==r||getBusinessObject(n).set("processRef",getBusinessObject(i))}),!0),this.revert("shape.create",(function(t){var e=t.hints||{},i=t.process||e.process,n=t.processRef||e.processRef,r=t.shape,s=e.participant;!i||s&&r!==s||getBusinessObject(r).set("processRef",n)}),!0),this.postExecute("shape.create",(function(t){var e=t.hints||{},n=t.process||t.hints.process,r=t.shape,s=e.participant;if(n){var a=n.children.slice();s?r===s&&i.moveElements(a,{x:0,y:0},s):i.moveElements(a,{x:0,y:0},r)}}),!0)}function getParticipantBounds(t,e){e={width:e.width+2*HORIZONTAL_PARTICIPANT_PADDING+PARTICIPANT_BORDER_WIDTH,height:e.height+2*VERTICAL_PARTICIPANT_PADDING};var i=Math.max(t.width,e.width),n=Math.max(t.height,e.height);return{x:-i/2,y:-n/2,width:i,height:n}}function getParticipantCreateConstraints(t,e){return{bottom:(e=asTRBL(e)).top+t.height/2-VERTICAL_PARTICIPANT_PADDING,left:e.right-t.width/2+HORIZONTAL_PARTICIPANT_PADDING,top:e.bottom-t.height/2+VERTICAL_PARTICIPANT_PADDING,right:e.left+t.width/2-HORIZONTAL_PARTICIPANT_PADDING-PARTICIPANT_BORDER_WIDTH}}function findParticipant(t){return find(t,(function(t){return is(t,"bpmn:Participant")}))}CreateParticipantBehavior.$inject=["canvas","eventBus","modeling"],inherits(CreateParticipantBehavior,CommandInterceptor);