import inherits from"inherits-browser";import{getOrientation,getMid,asTRBL}from"diagram-js/lib/layout/LayoutUtil";import{substract}from"diagram-js/lib/util/Math";import{hasExternalLabel}from"../../../util/LabelUtil";import CommandInterceptor from"diagram-js/lib/command/CommandInterceptor";var ALIGNMENTS=["top","bottom","left","right"],ELEMENT_LABEL_DISTANCE=10;export default function AdaptiveLabelPositioningBehavior(t,e){function n(t){if(hasExternalLabel(t)){var n=getOptimalPosition(t);n&&function(t,n){var i=getMid(t),o=t.label,a=getMid(o);if(o.parent){var r,c=asTRBL(t);switch(n){case"top":r={x:i.x,y:c.top-ELEMENT_LABEL_DISTANCE-o.height/2};break;case"left":r={x:c.left-ELEMENT_LABEL_DISTANCE-o.width/2,y:i.y};break;case"bottom":r={x:i.x,y:c.bottom+ELEMENT_LABEL_DISTANCE+o.height/2};break;case"right":r={x:c.right+ELEMENT_LABEL_DISTANCE+o.width/2,y:i.y}}var s=substract(r,a);e.moveShape(o,s)}}(t,n)}}CommandInterceptor.call(this,t),this.postExecuted(["connection.create","connection.layout","connection.updateWaypoints"],(function(t){var e=t.context,i=e.connection,o=i.source,a=i.target;!1!==(e.hints||{}).createElementsBehavior&&(n(o),n(a))})),this.postExecuted(["label.create"],(function(t){var e=t.context,i=e.shape;!1!==(e.hints||{}).createElementsBehavior&&n(i.labelTarget)})),this.postExecuted(["elements.create"],(function(t){var e=t.context,i=e.elements;!1!==(e.hints||{}).createElementsBehavior&&i.forEach((function(t){n(t)}))}))}function getTakenHostAlignments(t){var e,n=t.host,i=getMid(t),o=getOrientation(i,n);return e=o.indexOf("-")>=0?o.split("-"):[o],ALIGNMENTS.filter((function(t){return-1===e.indexOf(t)}))}function getTakenConnectionAlignments(t){var e=getMid(t);return[].concat(t.incoming.map((function(t){return t.waypoints[t.waypoints.length-2]})),t.outgoing.map((function(t){return t.waypoints[1]}))).map((function(t){return getApproximateOrientation(e,t)}))}function getOptimalPosition(t){var e=getMid(t.label),n=getApproximateOrientation(getMid(t),e);if(isAligned(n)){var i=getTakenConnectionAlignments(t);if(t.host){var o=getTakenHostAlignments(t);i=i.concat(o)}var a=ALIGNMENTS.filter((function(t){return-1===i.indexOf(t)}));if(-1===a.indexOf(n))return a[0]}}function getApproximateOrientation(t,e){return getOrientation(e,t,5)}function isAligned(t){return-1!==ALIGNMENTS.indexOf(t)}inherits(AdaptiveLabelPositioningBehavior,CommandInterceptor),AdaptiveLabelPositioningBehavior.$inject=["eventBus","modeling"];