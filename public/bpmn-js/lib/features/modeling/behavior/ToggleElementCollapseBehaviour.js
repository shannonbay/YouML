import inherits from"inherits-browser";import CommandInterceptor from"diagram-js/lib/command/CommandInterceptor";import{getDi,is}from"../../../util/ModelUtil";import{computeChildrenBBox}from"diagram-js/lib/features/resize/ResizeUtil";var LOW_PRIORITY=500;export default function ToggleElementCollapseBehaviour(e,t,i){CommandInterceptor.call(this,e),this.executed(["shape.toggleCollapse"],LOW_PRIORITY,(function(e){var t,i=e.context.shape;is(i,"bpmn:SubProcess")&&(i.collapsed?getDi(i).isExpanded=!1:((t=i.children).length&&t.forEach((function(e){"label"!==e.type||e.businessObject.name||(e.hidden=!0)})),getDi(i).isExpanded=!0))})),this.reverted(["shape.toggleCollapse"],LOW_PRIORITY,(function(e){var t=e.context.shape;t.collapsed?getDi(t).isExpanded=!1:getDi(t).isExpanded=!0})),this.postExecuted(["shape.toggleCollapse"],LOW_PRIORITY,(function(e){var o,n=e.context.shape,h=t.getDefaultSize(n);o=n.collapsed?function(e,t){return{x:e.x+(e.width-t.width)/2,y:e.y+(e.height-t.height)/2,width:t.width,height:t.height}}(n,h):function(e,t){var i,o,n=t;return i=filterVisible(e.children).concat([e]),(o=computeChildrenBBox(i))?(n.width=Math.max(o.width,n.width),n.height=Math.max(o.height,n.height),n.x=o.x+(o.width-n.width)/2,n.y=o.y+(o.height-n.height)/2):(n.x=e.x+(e.width-n.width)/2,n.y=e.y+(e.height-n.height)/2),n}(n,h),i.resizeShape(n,o,null,{autoResize:!n.collapsed&&"nwse"})}))}function filterVisible(e){return e.filter((function(e){return!e.hidden}))}inherits(ToggleElementCollapseBehaviour,CommandInterceptor),ToggleElementCollapseBehaviour.$inject=["eventBus","elementFactory","modeling"];