import inherits from"inherits-browser";import CommandInterceptor from"diagram-js/lib/command/CommandInterceptor";import{getBusinessObject,is}from"../../../util/ModelUtil";import{createCategory,createCategoryValue,linkCategoryValue,unlinkCategory,unlinkCategoryValue}from"./util/CategoryUtil";var LOWER_PRIORITY=770;export default function GroupBehavior(e,t,r,a,n,o){function c(e,t,a){var n=r.filter((function(e){return is(e,"bpmn:Group")})).filter((function(e){return e.businessObject!==a}));t&&!function(e,t){return e.some((function(e){var r=getBusinessObject(e);return(r.categoryValueRef&&r.categoryValueRef.$parent)===t}))}(n,t)&&unlinkCategory(t),e&&!function(e,t){return e.some((function(e){return getBusinessObject(e).categoryValueRef===t}))}(n,e)&&unlinkCategoryValue(e)}function u(e,r){return linkCategoryValue(e,r,t.getDefinitions())}function i(r,a){var n=getBusinessObject(r),o=n.categoryValueRef;o||(o=n.categoryValueRef=a.categoryValue=a.categoryValue||createCategoryValue(e));var c=o.$parent;c||(c=o.$parent=a.category=a.category||createCategory(e)),u(o,c,t.getDefinitions())}function l(e,t){var r=t.category,a=t.categoryValue,n=getBusinessObject(e);a?(n.categoryValueRef=null,c(a,r,n)):c(null,n.categoryValueRef.$parent,n)}function s(t,r){var a=e.create(t.$type);return o.copyElement(t,a,null,r)}n.invoke(CommandInterceptor,this),this.execute("label.create",(function(e){var t=e.context,r=t.labelTarget;is(r,"bpmn:Group")&&i(r,t)})),this.revert("label.create",(function(e){var t=e.context,r=t.labelTarget;is(r,"bpmn:Group")&&l(r,t)})),this.execute("shape.delete",(function(e){var t=e.context,r=t.shape,a=getBusinessObject(r);if(is(r,"bpmn:Group")&&!r.labelTarget){var n=t.categoryValue=a.categoryValueRef;n&&(c(n,t.category=n.$parent,a),a.categoryValueRef=null)}})),this.reverted("shape.delete",(function(e){var t=e.context,r=t.shape;if(is(r,"bpmn:Group")&&!r.labelTarget){var a=t.category,n=t.categoryValue,o=getBusinessObject(r);n&&(o.categoryValueRef=n,u(n,a))}})),this.execute("shape.create",(function(e){var t=e.context,r=t.shape;is(r,"bpmn:Group")&&!r.labelTarget&&getBusinessObject(r).categoryValueRef&&i(r,t)})),this.reverted("shape.create",(function(e){var t=e.context,r=t.shape;is(r,"bpmn:Group")&&!r.labelTarget&&getBusinessObject(r).categoryValueRef&&l(r,t)})),a.on("copyPaste.copyElement",LOWER_PRIORITY,(function(e){var t=e.descriptor,r=e.element;if(is(r,"bpmn:Group")&&!r.labelTarget){var a=getBusinessObject(r);if(a.categoryValueRef){var n=a.categoryValueRef;t.categoryValue=s(n,!0),n.$parent&&(t.category=s(n.$parent,!0))}}})),a.on("copyPaste.pasteElement",LOWER_PRIORITY,(function(e){var t=e.descriptor,r=t.businessObject,a=t.categoryValue,n=t.category;a&&(a=r.categoryValueRef=s(a)),n&&(a.$parent=s(n)),delete t.category,delete t.categoryValue}))}GroupBehavior.$inject=["bpmnFactory","bpmnjs","elementRegistry","eventBus","injector","moddleCopy"],inherits(GroupBehavior,CommandInterceptor);