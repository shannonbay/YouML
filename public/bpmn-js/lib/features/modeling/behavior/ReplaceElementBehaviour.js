import inherits from"inherits-browser";import{forEach,reduce}from"min-dash";import CommandInterceptor from"diagram-js/lib/command/CommandInterceptor";import{isEventSubProcess}from"../../../util/DiUtil";export default function ReplaceElementBehaviour(e,t,n,c,r,i){c.invoke(CommandInterceptor,this),this._bpmnReplace=e,this._elementRegistry=n,this._selection=i,this.postExecuted(["elements.create"],500,(function(e){var n=e.context,c=n.parent,r=n.elements,i=reduce(r,(function(e,n){var r=t.canReplace([n],n.host||n.parent||c);return r?e.concat(r.replacements):e}),[]);i.length&&this._replaceElements(r,i)}),this),this.postExecuted(["elements.move"],500,(function(e){var n=e.context,c=n.newParent,r=n.newHost,i=[];forEach(n.closure.topLevel,(function(e){i=isEventSubProcess(e)?i.concat(e.children):i.concat(e)})),1===i.length&&r&&(c=r);var o=t.canReplace(i,c);o&&this._replaceElements(i,o.replacements,r)}),this),this.postExecute(["shape.replace"],1500,(function(e){var n,c=e.context,r=c.oldShape,i=c.newShape,o=r.attachers;o&&o.length&&(n=t.canReplace(o,i),this._replaceElements(o,n.replacements))}),this),this.postExecuted(["shape.replace"],1500,(function(e){var t=e.context,n=t.oldShape,c=t.newShape;r.unclaimId(n.businessObject.id,n.businessObject),r.updateProperties(c,{id:n.id})}))}inherits(ReplaceElementBehaviour,CommandInterceptor),ReplaceElementBehaviour.prototype._replaceElements=function(e,t){var n=this._elementRegistry,c=this._bpmnReplace,r=this._selection;forEach(t,(function(t){var r={type:t.newElementType},i=n.get(t.oldElementId),o=e.indexOf(i);e[o]=c.replaceElement(i,r,{select:!1})})),t&&r.select(e)},ReplaceElementBehaviour.$inject=["bpmnReplace","bpmnRules","elementRegistry","injector","modeling","selection"];