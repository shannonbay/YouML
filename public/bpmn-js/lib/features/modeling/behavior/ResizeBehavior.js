import{is}from"../../../util/ModelUtil";import{isExpanded,isHorizontal}from"../../../util/DiUtil";import{asTRBL}from"diagram-js/lib/layout/LayoutUtil";import{collectLanes,getLanesRoot}from"../util/LaneUtil";var HIGH_PRIORITY=1500;export var GROUP_MIN_DIMENSIONS={width:140,height:120};export var LANE_MIN_DIMENSIONS={width:300,height:60};export var VERTICAL_LANE_MIN_DIMENSIONS={width:60,height:300};export var PARTICIPANT_MIN_DIMENSIONS={width:300,height:150};export var VERTICAL_PARTICIPANT_MIN_DIMENSIONS={width:150,height:300};export var SUB_PROCESS_MIN_DIMENSIONS={width:140,height:120};export var TEXT_ANNOTATION_MIN_DIMENSIONS={width:50,height:30};export default function ResizeBehavior(t){t.on("resize.start",HIGH_PRIORITY,(function(t){var i=t.context,o=i.shape,e=i.direction,a=i.balanced;(is(o,"bpmn:Lane")||is(o,"bpmn:Participant"))&&(i.resizeConstraints=getParticipantResizeConstraints(o,e,a)),is(o,"bpmn:SubProcess")&&isExpanded(o)&&(i.minDimensions=SUB_PROCESS_MIN_DIMENSIONS),is(o,"bpmn:TextAnnotation")&&(i.minDimensions=TEXT_ANNOTATION_MIN_DIMENSIONS)}))}ResizeBehavior.$inject=["eventBus"];var abs=Math.abs,min=Math.min,max=Math.max;function addToTrbl(t,i,o,e){var a=t[i];t[i]=void 0===a?o:e(o,a)}function addMin(t,i,o){return addToTrbl(t,i,o,min)}function addMax(t,i,o){return addToTrbl(t,i,o,max)}var LANE_PADDING={top:20,left:50,right:20,bottom:20},VERTICAL_LANE_PADDING={top:50,left:20,right:20,bottom:20};export function getParticipantResizeConstraints(t,i,o){var e=getLanesRoot(t),a=!0,r=!0,n=collectLanes(e,[e]),s=asTRBL(t),h={},d={},I=isHorizontal(t),N=I?LANE_MIN_DIMENSIONS:VERTICAL_LANE_MIN_DIMENSIONS;/n/.test(i)?d.top=s.bottom-N.height:/e/.test(i)?d.right=s.left+N.width:/s/.test(i)?d.bottom=s.top+N.height:/w/.test(i)&&(d.left=s.right-N.width),n.forEach((function(t){var e=asTRBL(t);I?(e.top<s.top-10&&(a=!1),e.bottom>s.bottom+10&&(r=!1)):(e.left<s.left-10&&(a=!1),e.right>s.right+10&&(r=!1)),/n/.test(i)&&(o&&abs(s.top-e.bottom)<10&&addMax(h,"top",e.top+N.height),abs(s.top-e.top)<5&&addMin(d,"top",e.bottom-N.height)),/e/.test(i)&&(o&&abs(s.right-e.left)<10&&addMin(h,"right",e.right-N.width),abs(s.right-e.right)<5&&addMax(d,"right",e.left+N.width)),/s/.test(i)&&(o&&abs(s.bottom-e.top)<10&&addMin(h,"bottom",e.bottom-N.height),abs(s.bottom-e.bottom)<5&&addMax(d,"bottom",e.top+N.height)),/w/.test(i)&&(o&&abs(s.left-e.right)<10&&addMax(h,"left",e.left+N.width),abs(s.left-e.left)<5&&addMin(d,"left",e.right-N.width))}));var m=e.children.filter((function(t){return!t.hidden&&!t.waypoints&&(is(t,"bpmn:FlowElement")||is(t,"bpmn:Artifact"))})),p=I?LANE_PADDING:VERTICAL_LANE_PADDING;return m.forEach((function(t){var o=asTRBL(t);!/n/.test(i)||I&&!a||addMin(d,"top",o.top-p.top),/e/.test(i)&&(I||r)&&addMax(d,"right",o.right+p.right),!/s/.test(i)||I&&!r||addMax(d,"bottom",o.bottom+p.bottom),/w/.test(i)&&(I||a)&&addMin(d,"left",o.left-p.left)})),{min:d,max:h}}