import{append as svgAppend,attr as svgAttr,create as svgCreate,remove as svgRemove}from"tiny-svg";import{getDi,is}from"../../util/ModelUtil";import{translate}from"diagram-js/lib/util/SvgTransformUtil";var MARKER_HIDDEN="djs-element-hidden",MARKER_LABEL_HIDDEN="djs-label-hidden";export default function LabelEditingPreview(e,t,i){var a,n,r,o=this,s=t.getDefaultLayer();e.on("directEditing.activate",(function(e){var d=e.active;if(a=d.element.label||d.element,is(a,"bpmn:TextAnnotation")){n=t.getAbsoluteBBox(a),r=svgCreate("g");var l=i.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:a.width,containerHeight:a.height,position:{mx:0,my:0}}),g=o.path=svgCreate("path");svgAttr(g,{d:l,strokeWidth:2,stroke:getStrokeColor(a)}),svgAppend(r,g),svgAppend(s,r),translate(r,a.x,a.y)}is(a,"bpmn:TextAnnotation")||a.labelTarget?t.addMarker(a,MARKER_HIDDEN):(is(a,"bpmn:Task")||is(a,"bpmn:CallActivity")||is(a,"bpmn:SubProcess")||is(a,"bpmn:Participant")||is(a,"bpmn:Lane"))&&t.addMarker(a,MARKER_LABEL_HIDDEN)})),e.on("directEditing.resize",(function(e){if(is(a,"bpmn:TextAnnotation")){var t=e.height,r=e.dy,s=Math.max(a.height/n.height*(t+r),0),d=i.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:a.width,containerHeight:s,position:{mx:0,my:0}});svgAttr(o.path,{d})}})),e.on(["directEditing.complete","directEditing.cancel"],(function(e){var i=e.active;i&&(t.removeMarker(i.element.label||i.element,MARKER_HIDDEN),t.removeMarker(a,MARKER_LABEL_HIDDEN)),a=void 0,n=void 0,r&&(svgRemove(r),r=void 0)}))}function getStrokeColor(e,t){return getDi(e).get("stroke")||t||"black"}LabelEditingPreview.$inject=["eventBus","canvas","pathMap"];