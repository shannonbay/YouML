import inherits from"inherits-browser";import{assign,forEach,isObject}from"min-dash";import BaseRenderer from"diagram-js/lib/draw/BaseRenderer";import{isExpanded,isHorizontal,isEventSubProcess}from"../util/DiUtil";import{getLabel}from"../util/LabelUtil";import{is}from"../util/ModelUtil";import{createLine}from"diagram-js/lib/util/RenderUtil";import{isTypedEvent,isThrowEvent,isCollection,getBounds,getDi,getSemantic,getCirclePath,getRoundRectPath,getDiamondPath,getRectPath,getFillColor,getStrokeColor,getLabelColor,getHeight,getWidth}from"./BpmnRenderUtil";import{query as domQuery}from"min-dom";import{append as svgAppend,attr as svgAttr,create as svgCreate,classes as svgClasses}from"tiny-svg";import{rotate,transform,translate}from"diagram-js/lib/util/SvgTransformUtil";import Ids from"ids";import{black}from"./BpmnRenderUtil";var markerIds=new Ids,ELEMENT_LABEL_DISTANCE=10,INNER_OUTER_DIST=3,PARTICIPANT_STROKE_WIDTH=1.5,TASK_BORDER_RADIUS=10,DEFAULT_OPACITY=.95,FULL_OPACITY=1,LOW_OPACITY=.25;export default function BpmnRenderer(t,e,r,o,i,n,l){BaseRenderer.call(this,e,l);var a=t&&t.defaultFillColor,s=t&&t.defaultStrokeColor,c=t&&t.defaultLabelColor;function h(t){return r.computeStyle(t,{strokeLinecap:"round",strokeLinejoin:"round",stroke:black,strokeWidth:2,fill:"white"})}function g(t){return r.computeStyle(t,["no-fill"],{strokeLinecap:"round",strokeLinejoin:"round",stroke:black,strokeWidth:2})}function k(t,e){var{ref:r={x:0,y:0},scale:o=1,element:n,parentGfx:l=i._svg}=e,a=svgCreate("marker",{id:t,viewBox:"0 0 20 20",refX:r.x,refY:r.y,markerWidth:20*o,markerHeight:20*o,orient:"auto"});svgAppend(a,n);var s=domQuery(":scope > defs",l);s||(s=svgCreate("defs"),svgAppend(l,s)),svgAppend(s,a)}function d(t,e,r,o){var i=markerIds.nextPrefixed("marker-");return function(t,e,r,o,i){"sequenceflow-end"===r&&k(e,{element:svgCreate("path",{d:"M 1 5 L 11 10 L 1 15 Z",...h({fill:i,stroke:i,strokeWidth:1})}),ref:{x:11,y:10},scale:.5,parentGfx:t}),"messageflow-start"===r&&k(e,{element:svgCreate("circle",{cx:6,cy:6,r:3.5,...h({fill:o,stroke:i,strokeWidth:1,strokeDasharray:[1e4,1]})}),ref:{x:6,y:6},parentGfx:t}),"messageflow-end"===r&&k(e,{element:svgCreate("path",{d:"m 1 5 l 0 -3 l 7 3 l -7 3 z",...h({fill:o,stroke:i,strokeWidth:1,strokeDasharray:[1e4,1]})}),ref:{x:8.5,y:5},parentGfx:t}),"association-start"===r&&k(e,{element:svgCreate("path",{d:"M 11 5 L 1 10 L 11 15",...g({fill:"none",stroke:i,strokeWidth:1.5,strokeDasharray:[1e4,1]})}),ref:{x:1,y:10},scale:.5,parentGfx:t}),"association-end"===r&&k(e,{element:svgCreate("path",{d:"M 1 5 L 11 10 L 1 15",...g({fill:"none",stroke:i,strokeWidth:1.5,strokeDasharray:[1e4,1]})}),ref:{x:11,y:10},scale:.5,parentGfx:t}),"conditional-flow-marker"===r&&k(e,{element:svgCreate("path",{d:"M 0 10 L 8 6 L 16 10 L 8 14 Z",...h({fill:o,stroke:i})}),ref:{x:-1,y:10},scale:.5,parentGfx:t}),"conditional-default-flow-marker"===r&&k(e,{element:svgCreate("path",{d:"M 6 4 L 10 16",...h({stroke:i,fill:"none"})}),ref:{x:0,y:10},scale:.5,parentGfx:t})}(t,i,e,r,o),"url(#"+i+")"}function f(t,e,r,o,i={}){isObject(o)&&(i=o,o=0),o=o||0,i=h(i);var n=svgCreate("circle",{cx:e/2,cy:r/2,r:Math.round((e+r)/4-o),...i});return svgAppend(t,n),n}function p(t,e,r,o,i,n){isObject(i)&&(n=i,i=0),i=i||0,n=h(n);var l=svgCreate("rect",{x:i,y:i,width:e-2*i,height:r-2*i,rx:o,ry:o,...n});return svgAppend(t,l),l}function S(t,e,r,o){r=g(r);var i=createLine(e,r,o);return svgAppend(t,i),i}function m(t,e,r){return S(t,e,r,5)}function u(t,e,r){r=g(r);var o=svgCreate("path",{...r,d:e});return svgAppend(t,o),o}function C(t,e,r,o){return u(e,r,assign({"data-marker":t},o))}function E(t){return H[t]}function A(t){return function(e,r,o){return E(t)(e,r,o)}}function y(t,e,r={}){var i=getSemantic(t),n=isThrowEvent(i);return i.get("eventDefinitions")&&i.get("eventDefinitions").length>1?i.get("parallelMultiple")?function(t,e,r={}){return u(t,o.getScaledPath("EVENT_PARALLEL_MULTIPLE",{xScaleFactor:1.2,yScaleFactor:1.2,containerWidth:e.width,containerHeight:e.height,position:{mx:.458,my:.194}}),{fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1})}(e,t,r):function(t,e,r={},i){return u(t,o.getScaledPath("EVENT_MULTIPLE",{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:e.width,containerHeight:e.height,position:{mx:.222,my:.36}}),{fill:i?getStrokeColor(e,s,r.stroke):getFillColor(e,a,r.fill),strokeWidth:1})}(e,t,r,n):isTypedEvent(i,"bpmn:MessageEventDefinition")?function(t,e,r={},i){return u(t,o.getScaledPath("EVENT_MESSAGE",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:e.width,containerHeight:e.height,position:{mx:.235,my:.315}}),{fill:i?getStrokeColor(e,s,r.stroke):getFillColor(e,a,r.fill),stroke:i?getFillColor(e,a,r.fill):getStrokeColor(e,s,r.stroke),strokeWidth:1})}(e,t,r,n):isTypedEvent(i,"bpmn:TimerEventDefinition")?function(t,e,r={}){var i=f(t,e.width,e.height,.2*e.height,{fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:2});u(t,o.getScaledPath("EVENT_TIMER_WH",{xScaleFactor:.75,yScaleFactor:.75,containerWidth:e.width,containerHeight:e.height,position:{mx:.5,my:.5}}),{stroke:getStrokeColor(e,s,r.stroke),strokeWidth:2});for(var n=0;n<12;n++){var l=o.getScaledPath("EVENT_TIMER_LINE",{xScaleFactor:.75,yScaleFactor:.75,containerWidth:e.width,containerHeight:e.height,position:{mx:.5,my:.5}}),c=e.width/2,h=e.height/2;u(t,l,{strokeWidth:1,stroke:getStrokeColor(e,s,r.stroke),transform:"rotate("+30*n+","+h+","+c+")"})}return i}(e,t,r):isTypedEvent(i,"bpmn:ConditionalEventDefinition")?function(t,e,r={}){return u(t,o.getScaledPath("EVENT_CONDITIONAL",{xScaleFactor:1,yScaleFactor:1,containerWidth:e.width,containerHeight:e.height,position:{mx:.5,my:.222}}),{fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1})}(e,t,r):isTypedEvent(i,"bpmn:SignalEventDefinition")?function(t,e,r={},i){return u(t,o.getScaledPath("EVENT_SIGNAL",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:e.width,containerHeight:e.height,position:{mx:.5,my:.2}}),{strokeWidth:1,fill:i?getStrokeColor(e,s,r.stroke):getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke)})}(e,t,r,n):isTypedEvent(i,"bpmn:EscalationEventDefinition")?function(t,e,r={},i){return u(t,o.getScaledPath("EVENT_ESCALATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:e.width,containerHeight:e.height,position:{mx:.5,my:.2}}),{fill:i?getStrokeColor(e,s,r.stroke):getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1})}(e,t,r,n):isTypedEvent(i,"bpmn:LinkEventDefinition")?function(t,e,r={},i){return u(t,o.getScaledPath("EVENT_LINK",{xScaleFactor:1,yScaleFactor:1,containerWidth:e.width,containerHeight:e.height,position:{mx:.57,my:.263}}),{fill:i?getStrokeColor(e,s,r.stroke):getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1})}(e,t,r,n):isTypedEvent(i,"bpmn:ErrorEventDefinition")?function(t,e,r={},i){return u(t,o.getScaledPath("EVENT_ERROR",{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:e.width,containerHeight:e.height,position:{mx:.2,my:.722}}),{fill:i?getStrokeColor(e,s,r.stroke):getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1})}(e,t,r,n):isTypedEvent(i,"bpmn:CancelEventDefinition")?function(t,e,r={},i){var n=u(t,o.getScaledPath("EVENT_CANCEL_45",{xScaleFactor:1,yScaleFactor:1,containerWidth:e.width,containerHeight:e.height,position:{mx:.638,my:-.055}}),{fill:i?getStrokeColor(e,s,r.stroke):"none",stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1});return rotate(n,45),n}(e,t,r,n):isTypedEvent(i,"bpmn:CompensateEventDefinition")?function(t,e,r={},i){return u(t,o.getScaledPath("EVENT_COMPENSATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:e.width,containerHeight:e.height,position:{mx:.22,my:.5}}),{fill:i?getStrokeColor(e,s,r.stroke):getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1})}(e,t,r,n):isTypedEvent(i,"bpmn:TerminateEventDefinition")?function(t,e,r={}){return f(t,e.width,e.height,8,{fill:getStrokeColor(e,s,r.stroke),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:4})}(e,t,r):null}var v={ParticipantMultiplicityMarker:function(t,e,r={}){var i=getWidth(e,r),n=getHeight(e,r);C("participant-multiplicity",t,o.getScaledPath("MARKER_PARALLEL",{xScaleFactor:1,yScaleFactor:1,containerWidth:i,containerHeight:n,position:{mx:(i/2-6)/i,my:(n-15)/n}}),{strokeWidth:2,fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke)})},SubProcessMarker:function(t,e,r={}){var i=p(t,14,14,0,{strokeWidth:1,fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke)});translate(i,e.width/2-7.5,e.height-20),C("sub-process",t,o.getScaledPath("MARKER_SUB_PROCESS",{xScaleFactor:1.5,yScaleFactor:1.5,containerWidth:e.width,containerHeight:e.height,position:{mx:(e.width/2-7.5)/e.width,my:(e.height-20)/e.height}}),{fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke)})},ParallelMarker:function(t,e,r){var i=getWidth(e,r),n=getHeight(e,r);C("parallel",t,o.getScaledPath("MARKER_PARALLEL",{xScaleFactor:1,yScaleFactor:1,containerWidth:i,containerHeight:n,position:{mx:(i/2+r.parallel)/i,my:(n-20)/n}}),{fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke)})},SequentialMarker:function(t,e,r){C("sequential",t,o.getScaledPath("MARKER_SEQUENTIAL",{xScaleFactor:1,yScaleFactor:1,containerWidth:e.width,containerHeight:e.height,position:{mx:(e.width/2+r.seq)/e.width,my:(e.height-19)/e.height}}),{fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke)})},CompensationMarker:function(t,e,r){C("compensation",t,o.getScaledPath("MARKER_COMPENSATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:e.width,containerHeight:e.height,position:{mx:(e.width/2+r.compensation)/e.width,my:(e.height-13)/e.height}}),{strokeWidth:1,fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke)})},LoopMarker:function(t,e,r){var i=getWidth(e,r),n=getHeight(e,r);C("loop",t,o.getScaledPath("MARKER_LOOP",{xScaleFactor:1,yScaleFactor:1,containerWidth:i,containerHeight:n,position:{mx:(i/2+r.loop)/i,my:(n-7)/n}}),{strokeWidth:1.5,fill:"none",stroke:getStrokeColor(e,s,r.stroke),strokeMiterlimit:.5})},AdhocMarker:function(t,e,r){var i=getWidth(e,r),n=getHeight(e,r);C("adhoc",t,o.getScaledPath("MARKER_ADHOC",{xScaleFactor:1,yScaleFactor:1,containerWidth:i,containerHeight:n,position:{mx:(i/2+r.adhoc)/i,my:(n-15)/n}}),{strokeWidth:1,fill:getStrokeColor(e,s,r.stroke),stroke:getStrokeColor(e,s,r.stroke)})}};function T(t,e,r,o){v[t](e,r,o)}function x(t,e,r,o={}){o={fill:o.fill,stroke:o.stroke,width:getWidth(e,o),height:getHeight(e,o)};var i=getSemantic(e),n=r&&r.includes("SubProcessMarker");o=n?{...o,seq:-21,parallel:-22,compensation:-42,loop:-18,adhoc:10}:{...o,seq:-5,parallel:-6,compensation:-27,loop:0,adhoc:10},forEach(r,(function(r){T(r,t,e,o)})),i.get("isForCompensation")&&T("CompensationMarker",t,e,o),is(i,"bpmn:AdHocSubProcess")&&T("AdhocMarker",t,e,o);var l=i.get("loopCharacteristics"),a=l&&l.get("isSequential");l&&(void 0===a&&T("LoopMarker",t,e,o),!1===a&&T("ParallelMarker",t,e,o),!0===a&&T("SequentialMarker",t,e,o))}function F(t,e,r={}){r=assign({size:{width:100}},r);var o=n.createText(e||"",r);return svgClasses(o).add("djs-label"),svgAppend(t,o),o}function W(t,e,r,o={}){var i=getSemantic(e),n=getBounds({x:e.x,y:e.y,width:e.width,height:e.height},o);return F(t,i.name,{align:r,box:n,padding:7,style:{fill:getLabelColor(e,c,s,o.stroke)}})}function _(t,e,r,o={}){var i=isHorizontal(r),n=F(t,e,{box:{height:30,width:i?getHeight(r,o):getWidth(r,o)},align:"center-middle",style:{fill:getLabelColor(r,c,s,o.stroke)}});if(i){var l=-1*getHeight(r,o);transform(n,0,-l,270)}}function b(t,e,r={}){var{width:o,height:i}=getBounds(e,r);return p(t,o,i,TASK_BORDER_RADIUS,{...r,fill:getFillColor(e,a,r.fill),fillOpacity:DEFAULT_OPACITY,stroke:getStrokeColor(e,s,r.stroke)})}function P(t,e,r={}){var o=getSemantic(e),i=getFillColor(e,a,r.fill),n=getStrokeColor(e,s,r.stroke);return"One"!==o.get("associationDirection")&&"Both"!==o.get("associationDirection")||(r.markerEnd=d(t,"association-end",i,n)),"Both"===o.get("associationDirection")&&(r.markerStart=d(t,"association-start",i,n)),r=pickAttrs(r,["markerStart","markerEnd"]),m(t,e.waypoints,{...r,stroke:n,strokeDasharray:"0, 5"})}function R(t,e,r={}){var i=getFillColor(e,a,r.fill),n=getStrokeColor(e,s,r.stroke),l=u(t,o.getScaledPath("DATA_OBJECT_PATH",{xScaleFactor:1,yScaleFactor:1,containerWidth:e.width,containerHeight:e.height,position:{mx:.474,my:.296}}),{fill:i,fillOpacity:DEFAULT_OPACITY,stroke:n}),c=getSemantic(e);return isCollection(c)&&u(t,o.getScaledPath("DATA_OBJECT_COLLECTION_PATH",{xScaleFactor:1,yScaleFactor:1,containerWidth:e.width,containerHeight:e.height,position:{mx:.33,my:(e.height-18)/e.height}}),{strokeWidth:2,fill:i,stroke:n}),l}function w(t,e,r={}){return f(t,e.width,e.height,{fillOpacity:DEFAULT_OPACITY,...r,fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke)})}function L(t,e,r={}){return function(t,e,r,o){var i=e/2,n=r/2,l=[{x:i,y:0},{x:e,y:n},{x:i,y:r},{x:0,y:n}].map((function(t){return t.x+","+t.y})).join(" ");o=h(o);var a=svgCreate("polygon",{...o,points:l});return svgAppend(t,a),a}(t,e.width,e.height,{fill:getFillColor(e,a,r.fill),fillOpacity:DEFAULT_OPACITY,stroke:getStrokeColor(e,s,r.stroke)})}function D(t,e,r={}){var o=p(t,getWidth(e,r),getHeight(e,r),0,{fill:getFillColor(e,a,r.fill),fillOpacity:r.fillOpacity||DEFAULT_OPACITY,stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1.5}),i=getSemantic(e);return is(i,"bpmn:Lane")&&_(t,i.get("name"),e,r),o}function I(t,e,r={}){var o=b(t,e,r);isEventSubProcess(e)&&svgAttr(o,{strokeDasharray:"0, 5.5",strokeWidth:2.5});var i=isExpanded(e);return W(t,e,i?"center-top":"center-middle",r),x(t,e,i?void 0:["SubProcessMarker"],r),o}function O(t,e,r={}){var o=b(t,e,r);return W(t,e,"center-middle",r),x(t,e,void 0,r),o}var H=this.handlers={"bpmn:AdHocSubProcess":function(t,e,r={}){return I(t,e,r=isExpanded(e)?pickAttrs(r,["fill","stroke","width","height"]):pickAttrs(r,["fill","stroke"]))},"bpmn:Association":function(t,e,r={}){return P(t,e,r=pickAttrs(r,["fill","stroke"]))},"bpmn:BoundaryEvent":function(t,e,r={}){var{renderIcon:o=!0}=r;r=pickAttrs(r,["fill","stroke"]);var i=getSemantic(e).get("cancelActivity");r={strokeWidth:1.5,fill:getFillColor(e,a,r.fill),fillOpacity:FULL_OPACITY,stroke:getStrokeColor(e,s,r.stroke)},i||(r.strokeDasharray="6");var n=w(t,e,r);return f(t,e.width,e.height,INNER_OUTER_DIST,{...r,fill:"none"}),o&&y(e,t,r),n},"bpmn:BusinessRuleTask":function(t,e,r={}){var i=O(t,e,r=pickAttrs(r,["fill","stroke"])),n=u(t,o.getScaledPath("TASK_TYPE_BUSINESS_RULE_MAIN",{abspos:{x:8,y:8}}));svgAttr(n,{fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1});var l=u(t,o.getScaledPath("TASK_TYPE_BUSINESS_RULE_HEADER",{abspos:{x:8,y:8}}));return svgAttr(l,{fill:getStrokeColor(e,s,r.stroke),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1}),i},"bpmn:CallActivity":function(t,e,r={}){return r=pickAttrs(r,["fill","stroke"]),I(t,e,{strokeWidth:5,...r})},"bpmn:ComplexGateway":function(t,e,r={}){var i=L(t,e,r=pickAttrs(r,["fill","stroke"]));return u(t,o.getScaledPath("GATEWAY_COMPLEX",{xScaleFactor:.5,yScaleFactor:.5,containerWidth:e.width,containerHeight:e.height,position:{mx:.46,my:.26}}),{fill:getStrokeColor(e,s,r.stroke),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1}),i},"bpmn:DataInput":function(t,e,r={}){r=pickAttrs(r,["fill","stroke"]);var i=o.getRawPath("DATA_ARROW"),n=R(t,e,r);return u(t,i,{fill:"none",stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1}),n},"bpmn:DataInputAssociation":function(t,e,r={}){return r=pickAttrs(r,["fill","stroke"]),P(t,e,{...r,markerEnd:d(t,"association-end",getFillColor(e,a,r.fill),getStrokeColor(e,s,r.stroke))})},"bpmn:DataObject":function(t,e,r={}){return R(t,e,r=pickAttrs(r,["fill","stroke"]))},"bpmn:DataObjectReference":A("bpmn:DataObject"),"bpmn:DataOutput":function(t,e,r={}){r=pickAttrs(r,["fill","stroke"]);var i=o.getRawPath("DATA_ARROW"),n=R(t,e,r);return u(t,i,{strokeWidth:1,fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke)}),n},"bpmn:DataOutputAssociation":function(t,e,r={}){return r=pickAttrs(r,["fill","stroke"]),P(t,e,{...r,markerEnd:d(t,"association-end",getFillColor(e,a,r.fill),getStrokeColor(e,s,r.stroke))})},"bpmn:DataStoreReference":function(t,e,r={}){return r=pickAttrs(r,["fill","stroke"]),u(t,o.getScaledPath("DATA_STORE",{xScaleFactor:1,yScaleFactor:1,containerWidth:e.width,containerHeight:e.height,position:{mx:0,my:.133}}),{fill:getFillColor(e,a,r.fill),fillOpacity:DEFAULT_OPACITY,stroke:getStrokeColor(e,s,r.stroke),strokeWidth:2})},"bpmn:EndEvent":function(t,e,r={}){var{renderIcon:o=!0}=r;r=pickAttrs(r,["fill","stroke"]);var i=w(t,e,{...r,strokeWidth:4});return o&&y(e,t,r),i},"bpmn:EventBasedGateway":function(t,e,r={}){r=pickAttrs(r,["fill","stroke"]);var i=getSemantic(e),n=L(t,e,r);f(t,e.width,e.height,.2*e.height,{fill:getFillColor(e,"none",r.fill),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1});var l=i.get("eventGatewayType"),a=!!i.get("instantiate");if("Parallel"===l){var c=o.getScaledPath("GATEWAY_PARALLEL",{xScaleFactor:.4,yScaleFactor:.4,containerWidth:e.width,containerHeight:e.height,position:{mx:.474,my:.296}});u(t,c,{fill:"none",stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1})}else"Exclusive"===l&&(a||f(t,e.width,e.height,.26*e.height,{fill:"none",stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1}),function(){var i=o.getScaledPath("GATEWAY_EVENT_BASED",{xScaleFactor:.18,yScaleFactor:.18,containerWidth:e.width,containerHeight:e.height,position:{mx:.36,my:.44}});u(t,i,{fill:"none",stroke:getStrokeColor(e,s,r.stroke),strokeWidth:2})}());return n},"bpmn:ExclusiveGateway":function(t,e,r={}){var i=L(t,e,r=pickAttrs(r,["fill","stroke"])),n=o.getScaledPath("GATEWAY_EXCLUSIVE",{xScaleFactor:.4,yScaleFactor:.4,containerWidth:e.width,containerHeight:e.height,position:{mx:.32,my:.3}});return getDi(e).get("isMarkerVisible")&&u(t,n,{fill:getStrokeColor(e,s,r.stroke),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1}),i},"bpmn:Gateway":function(t,e,r={}){return L(t,e,r=pickAttrs(r,["fill","stroke"]))},"bpmn:Group":function(t,e,r={}){return r=pickAttrs(r,["fill","stroke","width","height"]),p(t,e.width,e.height,TASK_BORDER_RADIUS,{stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1.5,strokeDasharray:"10, 6, 0, 6",fill:"none",pointerEvents:"none",width:getWidth(e,r),height:getHeight(e,r)})},"bpmn:InclusiveGateway":function(t,e,r={}){var o=L(t,e,r=pickAttrs(r,["fill","stroke"]));return f(t,e.width,e.height,.24*e.height,{fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:2.5}),o},"bpmn:IntermediateEvent":function(t,e,r={}){var{renderIcon:o=!0}=r;r=pickAttrs(r,["fill","stroke"]);var i=w(t,e,{...r,strokeWidth:1.5});return f(t,e.width,e.height,INNER_OUTER_DIST,{fill:"none",stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1.5}),o&&y(e,t,r),i},"bpmn:IntermediateCatchEvent":A("bpmn:IntermediateEvent"),"bpmn:IntermediateThrowEvent":A("bpmn:IntermediateEvent"),"bpmn:Lane":function(t,e,r={}){return r=pickAttrs(r,["fill","stroke","width","height"]),D(t,e,{...r,fillOpacity:LOW_OPACITY})},"bpmn:ManualTask":function(t,e,r={}){var i=O(t,e,r=pickAttrs(r,["fill","stroke"]));return u(t,o.getScaledPath("TASK_TYPE_MANUAL",{abspos:{x:17,y:15}}),{fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:.5}),i},"bpmn:MessageFlow":function(t,e,r={}){r=pickAttrs(r,["fill","stroke"]);var i=getSemantic(e),n=getDi(e),l=getFillColor(e,a,r.fill),c=getStrokeColor(e,s,r.stroke),h=m(t,e.waypoints,{markerEnd:d(t,"messageflow-end",l,c),markerStart:d(t,"messageflow-start",l,c),stroke:c,strokeDasharray:"10, 11",strokeWidth:1.5});if(i.get("messageRef")){var g=h.getPointAtLength(h.getTotalLength()/2),k=o.getScaledPath("MESSAGE_FLOW_MARKER",{abspos:{x:g.x,y:g.y}}),f={strokeWidth:1};"initiating"===n.get("messageVisibleKind")?(f.fill=l,f.stroke=c):(f.fill=c,f.stroke=l);var p=u(t,k,f),S=F(t,i.get("messageRef").get("name"),{align:"center-top",fitBox:!0,style:{fill:c}}),C=p.getBBox(),E=S.getBBox(),A=g.x-E.width/2,y=g.y+C.height/2+ELEMENT_LABEL_DISTANCE;transform(S,A,y,0)}return h},"bpmn:ParallelGateway":function(t,e,r={}){var i=L(t,e,r=pickAttrs(r,["fill","stroke"]));return u(t,o.getScaledPath("GATEWAY_PARALLEL",{xScaleFactor:.6,yScaleFactor:.6,containerWidth:e.width,containerHeight:e.height,position:{mx:.46,my:.2}}),{fill:getStrokeColor(e,s,r.stroke),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1}),i},"bpmn:Participant":function(t,e,r={}){var o=D(t,e,r=pickAttrs(r,["fill","stroke","width","height"])),i=isExpanded(e),n=isHorizontal(e),l=getSemantic(e),a=l.get("name");if(i)S(t,n?[{x:30,y:0},{x:30,y:getHeight(e,r)}]:[{x:0,y:30},{x:getWidth(e,r),y:30}],{stroke:getStrokeColor(e,s,r.stroke),strokeWidth:PARTICIPANT_STROKE_WIDTH}),_(t,a,e,r);else{var h=getBounds(e,r);n||(h.height=getWidth(e,r),h.width=getHeight(e,r));var g=F(t,a,{box:h,align:"center-middle",style:{fill:getLabelColor(e,c,s,r.stroke)}});if(!n){var k=-1*getHeight(e,r);transform(g,0,-k,270)}}return l.get("participantMultiplicity")&&T("ParticipantMultiplicityMarker",t,e,r),o},"bpmn:ReceiveTask":function(t,e,r={}){r=pickAttrs(r,["fill","stroke"]);var i,n=getSemantic(e),l=O(t,e,r);return n.get("instantiate")?(f(t,28,28,4.4,{fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1}),i=o.getScaledPath("TASK_TYPE_INSTANTIATING_SEND",{abspos:{x:7.77,y:9.52}})):i=o.getScaledPath("TASK_TYPE_SEND",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:21,containerHeight:14,position:{mx:.3,my:.4}}),u(t,i,{fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1}),l},"bpmn:ScriptTask":function(t,e,r={}){var i=O(t,e,r=pickAttrs(r,["fill","stroke"]));return u(t,o.getScaledPath("TASK_TYPE_SCRIPT",{abspos:{x:15,y:20}}),{fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1}),i},"bpmn:SendTask":function(t,e,r={}){var i=O(t,e,r=pickAttrs(r,["fill","stroke"]));return u(t,o.getScaledPath("TASK_TYPE_SEND",{xScaleFactor:1,yScaleFactor:1,containerWidth:21,containerHeight:14,position:{mx:.285,my:.357}}),{fill:getStrokeColor(e,s,r.stroke),stroke:getFillColor(e,a,r.fill),strokeWidth:1}),i},"bpmn:SequenceFlow":function(t,e,r={}){r=pickAttrs(r,["fill","stroke"]);var o=getFillColor(e,a,r.fill),i=getStrokeColor(e,s,r.stroke),n=m(t,e.waypoints,{markerEnd:d(t,"sequenceflow-end",o,i),stroke:i}),l=getSemantic(e),{source:c}=e;if(c){var h=getSemantic(c);l.get("conditionExpression")&&is(h,"bpmn:Activity")&&svgAttr(n,{markerStart:d(t,"conditional-flow-marker",o,i)}),h.get("default")&&(is(h,"bpmn:Gateway")||is(h,"bpmn:Activity"))&&h.get("default")===l&&svgAttr(n,{markerStart:d(t,"conditional-default-flow-marker",o,i)})}return n},"bpmn:ServiceTask":function(t,e,r={}){var i=O(t,e,r=pickAttrs(r,["fill","stroke"]));return f(t,10,10,{fill:getFillColor(e,a,r.fill),stroke:"none",transform:"translate(6, 6)"}),u(t,o.getScaledPath("TASK_TYPE_SERVICE",{abspos:{x:12,y:18}}),{fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1}),f(t,10,10,{fill:getFillColor(e,a,r.fill),stroke:"none",transform:"translate(11, 10)"}),u(t,o.getScaledPath("TASK_TYPE_SERVICE",{abspos:{x:17,y:22}}),{fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:1}),i},"bpmn:StartEvent":function(t,e,r={}){var{renderIcon:o=!0}=r;r=pickAttrs(r,["fill","stroke"]),getSemantic(e).get("isInterrupting")||(r={...r,strokeDasharray:"6"});var i=w(t,e,r);return o&&y(e,t,r),i},"bpmn:SubProcess":function(t,e,r={}){return I(t,e,r=isExpanded(e)?pickAttrs(r,["fill","stroke","width","height"]):pickAttrs(r,["fill","stroke"]))},"bpmn:Task":function(t,e,r={}){return O(t,e,r=pickAttrs(r,["fill","stroke"]))},"bpmn:TextAnnotation":function(t,e,r={}){r=pickAttrs(r,["fill","stroke","width","height"]);var{width:i,height:n}=getBounds(e,r),l=p(t,i,n,0,0,{fill:"none",stroke:"none"});return u(t,o.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:i,containerHeight:n,position:{mx:0,my:0}}),{stroke:getStrokeColor(e,s,r.stroke)}),F(t,getSemantic(e).get("text")||"",{align:"left-top",box:getBounds(e,r),padding:7,style:{fill:getLabelColor(e,c,s,r.stroke)}}),l},"bpmn:Transaction":function(t,e,o={}){o=isExpanded(e)?pickAttrs(o,["fill","stroke","width","height"]):pickAttrs(o,["fill","stroke"]);var i=I(t,e,{strokeWidth:1.5,...o}),n=r.style(["no-fill","no-events"],{stroke:getStrokeColor(e,s,o.stroke),strokeWidth:1.5});return isExpanded(e)||(o={}),p(t,getWidth(e,o),getHeight(e,o),TASK_BORDER_RADIUS-INNER_OUTER_DIST,INNER_OUTER_DIST,n),i},"bpmn:UserTask":function(t,e,r={}){var i=O(t,e,r=pickAttrs(r,["fill","stroke"]));return u(t,o.getScaledPath("TASK_TYPE_USER_1",{abspos:{x:15,y:12}}),{fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:.5}),u(t,o.getScaledPath("TASK_TYPE_USER_2",{abspos:{x:15,y:12}}),{fill:getFillColor(e,a,r.fill),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:.5}),u(t,o.getScaledPath("TASK_TYPE_USER_3",{abspos:{x:15,y:12}}),{fill:getStrokeColor(e,s,r.stroke),stroke:getStrokeColor(e,s,r.stroke),strokeWidth:.5}),i},label:function(t,e,r={}){return function(t,e,r={}){var o={width:90,height:30,x:e.width/2+e.x,y:e.height/2+e.y};return F(t,getLabel(e),{box:o,fitBox:!0,style:assign({},n.getExternalStyle(),{fill:getLabelColor(e,c,s,r.stroke)})})}(t,e,r)}};this._drawPath=u,this._renderer=E}function pickAttrs(t,e=[]){return e.reduce(((e,r)=>(t[r]&&(e[r]=t[r]),e)),{})}inherits(BpmnRenderer,BaseRenderer),BpmnRenderer.$inject=["config.bpmnRenderer","eventBus","styles","pathMap","canvas","textRenderer"],BpmnRenderer.prototype.canRender=function(t){return is(t,"bpmn:BaseElement")},BpmnRenderer.prototype.drawShape=function(t,e,r={}){var{type:o}=e;return this._renderer(o)(t,e,r)},BpmnRenderer.prototype.drawConnection=function(t,e,r={}){var{type:o}=e;return this._renderer(o)(t,e,r)},BpmnRenderer.prototype.getShapePath=function(t){return is(t,"bpmn:Event")?getCirclePath(t):is(t,"bpmn:Activity")?getRoundRectPath(t,TASK_BORDER_RADIUS):is(t,"bpmn:Gateway")?getDiamondPath(t):getRectPath(t)};